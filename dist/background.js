/*! For license information please see background.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return r};var r={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new O(n||[]);return i(a,"_invoke",{value:T(e,r,s)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=l;var d={};function m(){}function p(){}function y(){}var g={};h(g,s,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(M([])));b&&b!==n&&o.call(b,s)&&(g=b);var w=y.prototype=m.prototype=Object.create(g);function x(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function L(t,r){function n(i,a,s,u){var c=f(t[i],t,a);if("throw"!==c.type){var h=c.arg,l=h.value;return l&&"object"==e(l)&&o.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(l).then((function(e){h.value=e,s(h)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(e,t){function o(){return new r((function(r,o){n(e,t,r,o)}))}return a=a?a.then(o,o):o()}})}function T(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=f(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function M(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:G}}function G(){return{value:void 0,done:!0}}return p.prototype=y,i(w,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:p,configurable:!0}),p.displayName=h(y,c,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,h(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},r.awrap=function(e){return{__await:e}},x(L.prototype),h(L.prototype,u,(function(){return this})),r.AsyncIterator=L,r.async=function(e,t,n,o,i){void 0===i&&(i=Promise);var a=new L(l(e,t,n,o),i);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(w),h(w,c,"Generator"),h(w,s,(function(){return this})),h(w,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=M,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},r}function r(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}chrome.action.onClicked.addListener((function(e){chrome.runtime.openOptionsPage()}));var n={tune:"balance",youtubeSummary:!0,aiCommand:!0,googleSearch:!0,initialPrompt:"You are ChatGPT, a large language model trained by OpenAI. \n  Your role is to provide succinct, relevant responses to user queries. \n  At the end of each interaction, you must provide one or more suggestions for future questions the user might ask. \n  These suggestions should follow this specific format: [{suggestion: '1', text: 'Your question here'}, {suggestion: '2', text: 'Your second question here'}]. \n  For instance, if a user asks 'Who is Spiderman?', you should end your response EXACTLY LIKE THIS: \"GPT-SUGGEST: [{suggestion: '1', text: 'How strong is Spiderman?'}, {suggestion: '2', text: 'Who are some of Spiderman's most formidable enemies?'}]\". \n  No leading or trailing phrases should be used around these suggestions; they should follow immediately after the answer to the initial query.\n  Users may summon you anywhere online by typing '/ai' or '/typeai'. If a user requests you to create content such as posts, captions, emails, or letters, \n  provide only the required text without any leading phrases (e.g., 'Sure, here is...') or concluding remarks. \n  Your response should be focused solely on fulfilling the user's request. Respond using Markdown."};chrome.runtime.onInstalled.addListener((function(){chrome.storage.sync.set(n),chrome.contextMenus.create({id:"summarize",title:"Summarize AI",contexts:["selection"]}),chrome.contextMenus.create({id:"summarize",title:"Summarize AI",contexts:["selection"]}),chrome.contextMenus.create({id:"chat",title:"Chat AI"}),chrome.contextMenus.create({id:"explain",title:"What is this?",contexts:["selection"]}),chrome.tabs.create({url:"https://myanpetra99.github.io/GPT-OTG-WEB/#/thankyou"})})),chrome.contextMenus.onClicked.addListener((function(e,t){"summarize"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{text:"getMousePosition"},(function(r){var n=r.x,o=r.y;console.log("This is the mouse position: "+n+" "+o),chrome.tabs.sendMessage(t.id,{text:"summarize",selectionText:e.selectionText,mousePosition:{x:n,y:o}})})),"chat"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{text:"getMousePosition"},(function(e){var r=e.x,n=e.y;console.log("This is the mouse position: "+r+" "+n),chrome.tabs.sendMessage(t.id,{text:"chat",mousePosition:{x:r,y:n}})})),"explain"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{text:"getMousePosition"},(function(r){var n=r.x,o=r.y;console.log("This is the mouse position: "+n+" "+o),chrome.tabs.sendMessage(t.id,{text:"explain",selectionText:e.selectionText,mousePosition:{x:n,y:o}})}))}));var o=null;chrome.webNavigation.onCompleted.addListener((function(e){var t=new URL(e.url);t.hostname.includes("google")&&t.pathname.includes("search")&&chrome.storage.sync.get(n,(function(r){if(r.googleSearch){console.log("This is the Google URL that triggered the listener: "+e.url);var n=t.searchParams.get("q");n!==o?(console.log("This is the Google Search Query that triggered the listener: "+n),o=n,chrome.tabs.sendMessage(e.tabId,{action:"googleSearch",query:n})):(console.log("This is the Google Search Query is same as last query: "+n+" and last query is: "+o),o=null)}})),t.hostname.includes("youtube")&&t.pathname.includes("watch")&&chrome.tabs.sendMessage(e.tabId,{action:"createYoutubeSummaryButton"})})),chrome.tabs.onUpdated.addListener((function(e,t,r){var n=new URL(r.url),o="https://myanpetra99.github.io/GPT-OTG-WEB/#/thankyou"==n;console.log("This is the url: "+n),o&&chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];chrome.tabs.sendMessage(t.id,{action:"displayThankYouPage"})})),n.hostname.includes("youtube")&&n.pathname.includes("watch")&&chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];chrome.tabs.sendMessage(t.id,{action:"createYoutubeSummaryButton"})}))})),chrome.runtime.onMessage.addListener(function(){var e,n=(e=t().mark((function e(r){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"OpenOptionsPage"===r.action&&chrome.runtime.openOptionsPage();case 1:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,u,"next",e)}function u(e){r(a,o,i,s,u,"throw",e)}s(void 0)}))});return function(e){return n.apply(this,arguments)}}()),chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"})})();